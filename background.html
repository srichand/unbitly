<!doctype html>
<head>
<script type="text/javascript">
chrome.extension.onRequest.addListener (
    function(request, sender, sendResponse) {
        if (request.method == "GetLocal") {
            var response = Object();
            response.in_cache = {};
            response.not_in_cache = [];
            response.errors = [];
            $.each(request.big_list, function (index, key) {
                try {
                    var value = localStorage.getItem(key);
                    response.in_cache[key] = value;
                } catch (error) {
                    response.errors.push(error);
                    response.not_in_cache.push(key);
                }
            });
            sendResponse(response);
        }
        
        if (request.method == "StoreLocal") {
            var response = Object();
            $.each(request.map, function (short_url, long_url)) {
                localStorage.setItem(short_url, long_url);
            }
            sendResponse(response);
        }
    }
);
</script>

</head>
</html>